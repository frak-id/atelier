# Frak Sandbox - Architecture & Tooling Specification

> A Bun monorepo-based sandbox orchestration system using Firecracker microVMs

---

## Table of Contents

1. [Technology Stack](#technology-stack)
2. [Monorepo Structure](#monorepo-structure)
3. [Server Infrastructure](#server-infrastructure)
4. [Package Specifications](#package-specifications)
5. [Development Workflow](#development-workflow)
6. [Deployment Strategy](#deployment-strategy)
7. [Implementation Roadmap](#implementation-roadmap)

---

## Technology Stack

### Application Layer

| Component | Technology | Version | Purpose |
|-----------|------------|---------|---------|
| Runtime | **Bun** | 1.1+ | JS/TS runtime, bundler, package manager |
| Monorepo | **Bun Workspaces** | native | Workspace management |
| API Framework | **ElysiaJS** | 1.0+ | Type-safe HTTP server with Eden for E2E types |
| Frontend Framework | **React** | 19+ | UI components |
| Frontend Router | **TanStack Router** | 1.0+ | Type-safe file-based routing |
| Frontend Build | **Vite** | 5+ | Dev server & bundling |
| Styling | **Tailwind CSS** | 4+ | Utility-first CSS |
| UI Components | **shadcn/ui** | latest | Accessible component primitives |
| State Management | **TanStack Query** | 5+ | Server state & caching |
| Validation | **TypeBox** | 0.32+ | Runtime validation (Elysia native) |
| Date/Time | **dayjs** | 1.11+ | Lightweight date manipulation |

### Infrastructure Layer

| Component | Technology | Version | Purpose |
|-----------|------------|---------|---------|
| MicroVM | **Firecracker** | 1.6+ | Fast, secure VM isolation |
| Reverse Proxy | **Caddy** | 2.8+ | Dynamic routing, auto HTTPS |
| Process Manager | **systemd** | native | Service lifecycle management |
| Container Build | **Docker** | 24+ | Rootfs image building only |
| OS | **Ubuntu Server** | 24.04 LTS | Host operating system |

### Development Tools

| Tool | Purpose |
|------|---------|
| **Biome** | Linting & formatting (faster than ESLint + Prettier) |
| **tsx** | TypeScript execution for scripts |
| **Lefthook** | Git hooks management |
| **Changesets** | Version management (if publishing packages) |

---

## Monorepo Structure

```
frak-sandbox/
├── apps/
│   ├── dashboard/                 # Admin web interface
│   │   ├── src/
│   │   │   ├── routes/            # TanStack Router file-based routes
│   │   │   │   ├── __root.tsx
│   │   │   │   ├── index.tsx
│   │   │   │   ├── sandboxes/
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   └── $id.tsx
│   │   │   │   ├── projects/
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   └── $id.tsx
│   │   │   │   └── settings.tsx
│   │   │   ├── components/
│   │   │   │   ├── ui/            # shadcn components
│   │   │   │   ├── sandbox-card.tsx
│   │   │   │   ├── project-card.tsx
│   │   │   │   └── ...
│   │   │   ├── lib/
│   │   │   │   ├── api.ts         # Eden client instance
│   │   │   │   └── utils.ts
│   │   │   ├── main.tsx
│   │   │   └── routeTree.gen.ts   # Auto-generated by TanStack Router
│   │   ├── index.html
│   │   ├── vite.config.ts
│   │   ├── tailwind.config.ts
│   │   └── package.json
│   │
│   └── manager/                   # Sandbox orchestration API
│       ├── src/
│       │   ├── index.ts           # Elysia app entry
│       │   ├── routes/
│       │   │   ├── sandboxes.ts   # /api/sandboxes/*
│       │   │   ├── projects.ts    # /api/projects/*
│       │   │   ├── images.ts      # /api/images/*
│       │   │   └── health.ts      # /health
│       │   ├── services/
│       │   │   ├── firecracker.ts # VM lifecycle management
│       │   │   ├── network.ts     # TAP device & bridge management
│       │   │   ├── overlay.ts     # Filesystem overlay management
│       │   │   ├── caddy.ts       # Dynamic route registration
│       │   │   ├── git.ts         # Repository caching & cloning
│       │   │   └── secrets.ts     # Secret injection
│       │   ├── lib/
│       │   │   ├── shell.ts       # Shell command execution helpers
│       │   │   ├── config.ts      # Environment configuration
│       │   │   └── logger.ts      # Structured logging
│       │   └── state/
│       │       └── store.ts       # In-memory state (sandboxes, projects)
│       ├── scripts/
│       │   ├── build-rootfs.ts    # Rootfs image builder
│       │   └── setup-network.ts   # Network initialization
│       └── package.json
│
├── packages/
│   ├── shared/                    # Shared types & utilities
│   │   ├── src/
│   │   │   ├── types/
│   │   │   │   ├── sandbox.ts
│   │   │   │   ├── project.ts
│   │   │   │   └── index.ts
│   │   │   ├── constants.ts
│   │   │   └── index.ts
│   │   └── package.json
│   │
│   └── eden-client/               # Generated API client (optional)
│       ├── src/
│       │   └── index.ts           # Re-export Eden treaty
│       └── package.json
│
├── infra/                         # Infrastructure configuration
│   ├── firecracker/
│   │   ├── kernels/               # Pre-built kernels
│   │   │   └── .gitkeep
│   │   └── rootfs/
│   │       ├── Dockerfile.base    # Base rootfs Dockerfile
│   │       ├── Dockerfile.dev     # Dev tools (VSCode, OpenCode)
│   │       └── scripts/
│   │           ├── sandbox-init   # VM init script
│   │           └── setup.sh       # Rootfs setup
│   ├── caddy/
│   │   └── Caddyfile              # Base Caddy configuration
│   ├── systemd/
│   │   ├── sandbox-manager.service
│   │   └── sandbox-network.service
│   └── scripts/
│       ├── setup-server.sh        # Initial server provisioning
│       ├── install-firecracker.sh
│       └── configure-network.sh
│
├── .github/
│   └── workflows/
│       ├── ci.yml                 # Lint, type-check, test
│       └── deploy.yml             # Deploy to Hetzner
│
├── package.json                   # Root package.json
├── bun.lockb
├── biome.json                     # Biome config
├── tsconfig.json                  # Base TypeScript config
└── README.md
```

---

## Server Infrastructure

### Hardware Requirements

**Recommended: Hetzner AX52** (€77/month)

| Spec | Value | Notes |
|------|-------|-------|
| CPU | AMD Ryzen 7 7700 | 8 cores / 16 threads |
| RAM | 64 GB DDR5 | ~20 sandboxes @ 2GB each |
| Storage | 1 TB NVMe | Fast overlay creation |
| Network | 1 Gbps | Sufficient for dev workloads |
| KVM | ✅ Required | Firecracker needs /dev/kvm |

**Alternative: Hetzner AX102** (€130/month) for more headroom.

### Operating System Setup

```
Ubuntu Server 24.04 LTS
├── Firecracker 1.6.0
├── Caddy 2.8+
├── Bun 1.1+
├── Docker 24+ (for image building only)
└── Standard networking tools (iproute2, iptables)
```

### Network Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Host Network                             │
│                                                                 │
│  ┌──────────────┐                                               │
│  │   eth0       │◄─── Public IP (e.g., 116.202.x.x)            │
│  │   (WAN)      │                                               │
│  └──────┬───────┘                                               │
│         │                                                       │
│         │ NAT (iptables MASQUERADE)                             │
│         │                                                       │
│  ┌──────▼───────┐                                               │
│  │    br0       │◄─── 172.16.0.1/24 (Bridge)                   │
│  │  (Bridge)    │                                               │
│  └──────┬───────┘                                               │
│         │                                                       │
│    ┌────┴────┬────────┬────────┐                               │
│    │         │        │        │                               │
│ ┌──▼──┐  ┌──▼──┐  ┌──▼──┐  ┌──▼──┐                           │
│ │tap-1│  │tap-2│  │tap-3│  │tap-n│  TAP devices              │
│ └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘                           │
│    │        │        │        │                                │
│ ┌──▼──┐  ┌──▼──┐  ┌──▼──┐  ┌──▼──┐                           │
│ │VM 1 │  │VM 2 │  │VM 3 │  │VM n │  Firecracker VMs          │
│ │.10  │  │.11  │  │.12  │  │.x   │  172.16.0.x               │
│ └─────┘  └─────┘  └─────┘  └─────┘                           │
└─────────────────────────────────────────────────────────────────┘

External Traffic Flow:
  Internet → Caddy (:443) → br0 → tap-x → VM:port
```

### Caddy Configuration Strategy

```
┌─────────────────────────────────────────────────────────────────┐
│                         Caddy                                   │
│                                                                 │
│  Static Routes (Caddyfile):                                     │
│  ├── dashboard.sandbox.frak.dev → localhost:3000 (dashboard)   │
│  └── api.sandbox.frak.dev → localhost:4000 (manager API)       │
│                                                                 │
│  Dynamic Routes (Admin API - added at runtime):                 │
│  ├── sandbox-{id}.sandbox.frak.dev → 172.16.0.x:8080 (VSCode) │
│  ├── opencode-{id}.sandbox.frak.dev → 172.16.0.x:3000 (OC)    │
│  └── app-{id}.sandbox.frak.dev → 172.16.0.x:* (app ports)     │
│                                                                 │
│  Features:                                                      │
│  ├── Automatic HTTPS (Let's Encrypt)                           │
│  ├── Wildcard certificate for *.sandbox.frak.dev              │
│  └── Zero-downtime route updates via Admin API                 │
└─────────────────────────────────────────────────────────────────┘
```

### Firecracker VM Anatomy

```
┌─────────────────────────────────────────────────────────────────┐
│                    Firecracker MicroVM                          │
│                                                                 │
│  Resources:                                                     │
│  ├── vCPUs: 1-8 (configurable)                                 │
│  ├── RAM: 512MB - 8GB (configurable)                           │
│  └── Boot time: ~125ms                                         │
│                                                                 │
│  Storage:                                                       │
│  ├── /dev/vda (rootfs) ──► Base image (read-only, shared)     │
│  └── /dev/vdb (overlay) ──► Per-VM writable layer             │
│                                                                 │
│  Filesystem (OverlayFS merged view):                           │
│  /                                                              │
│  ├── usr/bin/                                                  │
│  │   ├── code-server        # VSCode Server                    │
│  │   ├── opencode           # OpenCode CLI                     │
│  │   ├── node, bun, git     # Dev tools                        │
│  │   └── ...                                                   │
│  ├── home/dev/                                                 │
│  │   └── workspace/         # Git repo mounted here            │
│  ├── etc/sandbox/                                              │
│  │   ├── network.conf       # IP configuration                 │
│  │   └── secrets/           # Injected secrets                 │
│  └── sbin/                                                     │
│      └── sandbox-init       # Custom init (no systemd)         │
│                                                                 │
│  Services (started by sandbox-init):                           │
│  ├── SSH server (:22)                                          │
│  ├── code-server (:8080)                                       │
│  └── opencode serve (:3000)                                    │
│                                                                 │
│  Network:                                                       │
│  └── eth0 ──► 172.16.0.x/24, gateway 172.16.0.1               │
└─────────────────────────────────────────────────────────────────┘
```

### Storage Layout

```
/var/lib/sandbox/                    # Main data directory
├── firecracker/
│   ├── kernels/
│   │   └── vmlinux-5.10            # Pre-built kernel (~10MB)
│   └── rootfs/
│       ├── base.ext4               # Minimal Alpine (~500MB)
│       └── dev.ext4                # With VSCode + tools (~2GB)
│
├── overlays/                        # Per-sandbox writable layers
│   ├── {sandbox-id-1}.ext4         # Sparse file (~512MB allocated)
│   ├── {sandbox-id-2}.ext4
│   └── ...
│
├── git-cache/                       # Bare repository cache
│   ├── frak-id--wallet.git         # Bare clone
│   ├── frak-id--backend.git
│   └── ...
│
├── secrets/                         # Encrypted secrets per project
│   ├── project-abc/
│   │   └── .env.enc
│   └── project-xyz/
│       └── .env.enc
│
└── sockets/                         # Firecracker API sockets
    ├── fc-{sandbox-id-1}.sock
    └── ...
```

---

## Package Specifications

### `apps/dashboard`

**Purpose**: Admin web interface for managing sandboxes, projects, and images.

**Key Dependencies**:
```json
{
  "dependencies": {
    "@tanstack/react-router": "^1.0.0",
    "@tanstack/react-query": "^5.0.0",
    "@elysia/eden": "^1.0.0",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "tailwindcss": "^4.0.0",
    "dayjs": "^1.11.0"
  },
  "devDependencies": {
    "@tanstack/router-vite-plugin": "^1.0.0",
    "@types/react": "^19.0.0",
    "vite": "^5.0.0",
    "typescript": "^5.5.0"
  }
}
```

**Route Structure**:
```
/                       → Dashboard overview (active sandboxes, quick actions)
/sandboxes              → List all sandboxes
/sandboxes/:id          → Sandbox detail (URLs, logs, resource usage)
/projects               → List all projects
/projects/:id           → Project detail (config, secrets, spawn sandbox)
/images                 → List base images
/images/build           → Build new image from Dockerfile
/settings               → System settings (domain, resources defaults)
```

### `apps/manager`

**Purpose**: Backend API that orchestrates Firecracker VMs and manages system resources.

**Key Dependencies**:
```json
{
  "dependencies": {
    "elysia": "^1.0.0",
    "@elysiajs/cors": "^1.0.0",
    "@elysiajs/swagger": "^1.0.0",
    "@sinclair/typebox": "^0.32.0",
    "pino": "^9.0.0",
    "pino-pretty": "^11.0.0",
    "dayjs": "^1.11.0",
    "nanoid": "^5.0.0"
  }
}
```

**API Endpoints**:
```
Health:
  GET  /health                      → Service health check

Sandboxes:
  GET  /api/sandboxes               → List all sandboxes
  POST /api/sandboxes               → Create new sandbox
  GET  /api/sandboxes/:id           → Get sandbox details
  DELETE /api/sandboxes/:id         → Destroy sandbox
  POST /api/sandboxes/:id/exec      → Execute command in sandbox

Projects:
  GET  /api/projects                → List all projects
  POST /api/projects                → Create new project
  GET  /api/projects/:id            → Get project details
  PUT  /api/projects/:id            → Update project config
  DELETE /api/projects/:id          → Delete project
  POST /api/projects/:id/secrets    → Update project secrets
  POST /api/projects/:id/sync       → Sync git cache

Images:
  GET  /api/images                  → List available rootfs images
  POST /api/images/build            → Build new image (async)
  GET  /api/images/:id/status       → Get build status
  DELETE /api/images/:id            → Delete image

System:
  GET  /api/system/stats            → Resource usage (CPU, RAM, sandboxes)
  POST /api/system/cleanup          → Cleanup orphaned resources
```

**Service Layer**:
```
services/
├── firecracker.ts     # spawn(), destroy(), getStatus(), execCommand()
├── network.ts         # createTap(), deleteTap(), allocateIp()
├── overlay.ts         # createOverlay(), deleteOverlay(), injectConfig()
├── caddy.ts           # registerRoute(), unregisterRoute()
├── git.ts             # cacheRepo(), cloneToOverlay(), updateCache()
└── secrets.ts         # encrypt(), decrypt(), inject()
```

### `packages/shared`

**Purpose**: Shared TypeScript types and constants between dashboard and manager.

**Exports**:
```typescript
// types/sandbox.ts
export interface Sandbox {
  id: string;
  status: 'creating' | 'running' | 'stopped' | 'error';
  projectId: string;
  branch: string;
  ipAddress: string;
  urls: {
    vscode: string;
    opencode: string;
    ssh: string;
  };
  resources: {
    vcpus: number;
    memoryMb: number;
  };
  createdAt: string;
}

// types/project.ts
export interface Project {
  id: string;
  name: string;
  gitUrl: string;
  defaultBranch: string;
  hasSecrets: boolean;
  createdAt: string;
}

// constants.ts
export const DEFAULT_VCPUS = 2;
export const DEFAULT_MEMORY_MB = 2048;
export const SANDBOX_DOMAIN_SUFFIX = 'sandbox.frak.dev';
```

---

## Development Workflow

### Local Development

```bash
# 1. Clone and install
git clone https://github.com/frak-id/frak-sandbox.git
cd frak-sandbox
bun install

# 2. Start dashboard (with hot reload)
bun run --filter=dashboard dev
# → http://localhost:5173

# 3. Start manager (local mode - mocked Firecracker)
bun run --filter=manager dev
# → http://localhost:4000
# → Swagger: http://localhost:4000/swagger

# 4. Run all checks
bun run check        # Biome lint + format check
bun run typecheck    # TypeScript check all packages
bun run test         # Run tests
```

### Manager Local Mode

For local development without Firecracker, the manager should have a "mock mode" that simulates VM operations:

```typescript
// src/lib/config.ts
export const config = {
  mode: process.env.SANDBOX_MODE || 'production', // 'production' | 'mock'
  // ...
};

// src/services/firecracker.ts
export async function spawn(options: SpawnOptions): Promise<Sandbox> {
  if (config.mode === 'mock') {
    // Return fake sandbox with localhost URLs
    return mockSpawn(options);
  }
  // Real Firecracker spawn
  return realSpawn(options);
}
```

### Git Workflow

```
main                    # Production branch
├── develop             # Integration branch
└── feature/*           # Feature branches

Commit convention: Conventional Commits
  feat: Add sandbox resource limits
  fix: Correct TAP device cleanup
  chore: Update dependencies
```

---

## Deployment Strategy

### Initial Server Setup

```bash
# On fresh Hetzner server (as root)

# 1. Run setup script
curl -sSL https://raw.githubusercontent.com/frak-id/frak-sandbox/main/infra/scripts/setup-server.sh | bash

# This script will:
#   - Update system packages
#   - Install Bun, Docker, Caddy
#   - Install Firecracker + download kernel
#   - Configure network bridge
#   - Create directory structure
#   - Setup systemd services

# 2. Build base rootfs image
cd /opt/frak-sandbox
bun run build:rootfs

# 3. Configure DNS
# Add wildcard A record: *.sandbox.frak.dev → server IP

# 4. Start services
systemctl start sandbox-manager
systemctl start caddy
```

### Systemd Services

**sandbox-manager.service**:
```ini
[Unit]
Description=Frak Sandbox Manager
After=network.target sandbox-network.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/frak-sandbox/apps/manager
ExecStart=/root/.bun/bin/bun run start
Restart=on-failure
RestartSec=5
Environment=NODE_ENV=production
Environment=SANDBOX_MODE=production

[Install]
WantedBy=multi-user.target
```

**sandbox-network.service**:
```ini
[Unit]
Description=Sandbox Network Bridge
After=network.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/opt/frak-sandbox/infra/scripts/configure-network.sh

[Install]
WantedBy=multi-user.target
```

### Deployment Process

```bash
# From CI/CD or manual

# 1. SSH to server
ssh root@sandbox.frak.dev

# 2. Pull latest code
cd /opt/frak-sandbox
git pull origin main

# 3. Install dependencies
bun install

# 4. Build dashboard
bun run --filter=dashboard build

# 5. Restart manager
systemctl restart sandbox-manager

# Zero-downtime: Running sandboxes are unaffected
# (Firecracker processes are independent of the manager)
```

### Caddy Production Config

```caddyfile
{
    admin localhost:2019
    email ssl@frak.dev
}

# Dashboard
dashboard.sandbox.frak.dev {
    root * /opt/frak-sandbox/apps/dashboard/dist
    file_server
    try_files {path} /index.html
}

# Manager API
api.sandbox.frak.dev {
    reverse_proxy localhost:4000
}

# Wildcard for sandbox subdomains (routes added dynamically)
*.sandbox.frak.dev {
    tls {
        dns cloudflare {env.CLOUDFLARE_API_TOKEN}
    }
    
    # Fallback - dynamic routes take precedence
    respond "Sandbox not found" 404
}
```

---

## Implementation Roadmap

### Phase 1: Foundation (Week 1)

**Goals**: Server ready, basic spawn working

- [ ] Provision Hetzner AX52
- [ ] Run setup script (Firecracker, Caddy, Bun)
- [ ] Build minimal rootfs (Alpine + SSH only)
- [ ] Test manual Firecracker spawn
- [ ] Configure network bridge + NAT
- [ ] Setup DNS wildcard

**Deliverables**:
- SSH into a Firecracker VM from host
- VM has internet access via NAT

### Phase 2: Manager API (Week 2)

**Goals**: API can spawn/destroy sandboxes

- [ ] Initialize Bun monorepo
- [ ] Implement manager services:
  - [ ] `firecracker.ts` - spawn/destroy
  - [ ] `network.ts` - TAP management
  - [ ] `overlay.ts` - filesystem setup
  - [ ] `caddy.ts` - route registration
- [ ] Implement API routes (sandboxes CRUD)
- [ ] Add Swagger documentation
- [ ] Deploy to server with systemd

**Deliverables**:
- `POST /api/sandboxes` spawns a working VM
- `DELETE /api/sandboxes/:id` cleans up completely
- Sandbox accessible via `sandbox-{id}.sandbox.frak.dev`

### Phase 3: Enhanced Rootfs (Week 2-3)

**Goals**: Dev-ready sandbox environment

- [ ] Add to rootfs:
  - [ ] VSCode Server (code-server)
  - [ ] OpenCode CLI
  - [ ] Node.js 22 LTS
  - [ ] Bun
  - [ ] Git + common tools
- [ ] Configure sandbox-init to start services
- [ ] Test VSCode Server access
- [ ] Test OpenCode serve mode

**Deliverables**:
- VSCode accessible at `sandbox-{id}.sandbox.frak.dev`
- OpenCode accessible at `opencode-{id}.sandbox.frak.dev`

### Phase 4: Git & Projects (Week 3)

**Goals**: Project-based sandbox spawning

- [ ] Implement git cache service
- [ ] Implement project CRUD API
- [ ] Add git clone to spawn process
- [ ] Implement secrets injection
- [ ] Add project-specific sandbox config

**Deliverables**:
- Create project → spawn sandbox → repo cloned in `/home/dev/workspace`
- Secrets available in sandbox

### Phase 5: Dashboard (Week 3-4)

**Goals**: Functional admin UI

- [ ] Setup TanStack Router
- [ ] Implement views:
  - [ ] Dashboard overview
  - [ ] Sandbox list/detail
  - [ ] Project list/detail
  - [ ] New sandbox modal
  - [ ] New project form
- [ ] Connect to API via Eden
- [ ] Add real-time status updates (polling or SSE)

**Deliverables**:
- Spawn sandbox from UI
- View sandbox URLs and status
- Delete sandbox from UI

### Phase 6: Polish (Week 4)

**Goals**: Production-ready

- [ ] Error handling & recovery
- [ ] Logging & monitoring
- [ ] Boot time optimization (<200ms target)
- [ ] Documentation
- [ ] CI/CD pipeline

**Deliverables**:
- Stable system for team use
- Clear documentation
- Automated deployments

---

## Future Considerations (Post-POC)

These are explicitly out of scope for the POC but worth keeping in mind:

1. **Multi-model sandbox execution**: Spawn multiple sandboxes with same prompt, different LLM configs
2. **Slack integration**: `/sandbox spawn project-name` bot command
3. **LLM usage proxy**: Centralized API key management, usage tracking, cost allocation
4. **Persistent volumes**: Data that survives sandbox restarts
5. **Snapshot/restore**: Save sandbox state and restore later
6. **Team features**: Multi-user auth, sandbox sharing, access control
7. **Resource quotas**: Per-user/project limits
8. **Metrics dashboard**: Resource usage, spawn times, costs

---

## Quick Reference

### Commands Cheatsheet

```bash
# Development
bun install                    # Install all dependencies
bun run dev                    # Start all in dev mode
bun run check                  # Lint + format
bun run typecheck              # TypeScript check

# Deployment
bun run build                  # Build all packages
bun run build:rootfs           # Build Firecracker rootfs

# Server management
systemctl status sandbox-manager
systemctl restart sandbox-manager
journalctl -u sandbox-manager -f

# Firecracker debugging
curl --unix-socket /var/lib/sandbox/sockets/fc-{id}.sock http://localhost/
```

### Key Ports

| Service | Port | Access |
|---------|------|--------|
| Dashboard | 5173 (dev) / 80 | dashboard.sandbox.frak.dev |
| Manager API | 4000 | api.sandbox.frak.dev |
| Caddy Admin | 2019 | localhost only |
| Sandbox VSCode | 8080 | sandbox-{id}.sandbox.frak.dev |
| Sandbox OpenCode | 3000 | opencode-{id}.sandbox.frak.dev |
| Sandbox SSH | 22 | Via host SSH tunnel |

### Key Paths

| Path | Purpose |
|------|---------|
| `/opt/frak-sandbox` | Application code |
| `/var/lib/sandbox` | Runtime data (overlays, sockets, cache) |
| `/var/lib/sandbox/firecracker` | Kernels and rootfs images |
| `/var/log/sandbox` | Application logs |