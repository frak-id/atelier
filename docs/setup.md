# Setup (Debian + KVM)

## Requirements

- Debian 12 with systemd
- x86_64 CPU with virtualization enabled
- `/dev/kvm` available (bare metal)
- Wildcard DNS for sandbox subdomains
- Ports `80` and `443` open

## Install

```bash
curl -fsSL https://raw.githubusercontent.com/frak-id/oc-sandbox/main/infra/scripts/install.sh | bash
```

The installer prompts for:

- Domain suffix and service domains
- TLS email for automatic HTTPS
- GitHub OAuth settings
- JWT secret (auto‑generated by default)

## Config Location

By default, the config is read from:

```
/etc/frak-sandbox/sandbox.config.json
```

You can override this with `FRAK_CONFIG=/path/to/sandbox.config.json`.
- Allowed org/users

It writes `/etc/frak-sandbox/sandbox.config.json`, runs `frak-sandbox setup`,
and downloads the server bundle.

## Post‑Install

Build the base image:

```bash
frak-sandbox images build dev-base
```

Check manager health:

```bash
frak-sandbox manager status
```

## Update

```bash
frak-sandbox update
```

If the agent changed, the CLI will prompt to rebuild the base image.

## Optional: Preconfigure Storage

If you add `setup.storage` to `/etc/frak-sandbox/sandbox.config.json`, the CLI
will skip storage prompts. Example:

```json
{
  "setup": {
    "storage": {
      "method": "loop",
      "loopSizeGb": 100
    }
  }
}
```

You can also preconfigure network behavior:

```json
{
  "setup": {
    "network": {
      "onExists": "status"
    }
  }
}
```

## Troubleshooting

- **No `/dev/kvm`**: ensure virtualization is enabled and use bare‑metal.
- **Caddy not issuing certs**: confirm DNS wildcard and open ports 80/443.
- **Manager unhealthy**: `journalctl -u frak-sandbox-manager -n 200 --no-pager`
